<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FieldHub | Integrated Field Operations</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">



    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles/main.css">
</head>

<body>
    <!-- Splash Screen -->
    <div id="splash-screen">
        <div class="splash-content">
            <img src="assets/logo.png" alt="FieldHub" class="pulse" style="width: 120px; height: 120px;">
            <h1 style="font-size: 2rem; margin-top: 20px; color: white;">FieldHub</h1>
        </div>
    </div>

    <!-- Theme Toggle (Global - Hidden on dashboards) -->
    <div class="theme-toggle" id="theme-toggle" title="Toggle theme" onclick="toggleTheme()">
        <i class="theme-icon fa-solid fa-moon"></i>
    </div>

    <div class="app-background">
        <!-- Background Blobs Removed -->
    </div>

    <!-- Floating Particles -->
    <!-- Floating Particles Removed for cleaner UI -->


    <!-- Modal Helpers -->
    <div id="app">
        <!-- Auth View -->
        <!-- Auth View (Split Layout) -->
        <section id="auth-view" class="view hidden split-layout">
            <!-- Left Panel: Hero -->
            <div class="hero-panel">
                <div class="hero-content">
                    <div class="hero-brand">
                        <img src="assets/logo.png" alt="FieldHub" style="width: 48px; height: 48px;">
                        <h1>FieldHub</h1>
                    </div>
                    <h2>Command Your Field Operations.</h2>
                    <p>Real-time tracking, task management, and seamless communication for modern teams.</p>

                    <div class="hero-stats">
                        <div class="stat-pill">
                            <i class="fa-solid fa-globe"></i>
                            <span>Live Tracking</span>
                        </div>
                        <div class="stat-pill">
                            <i class="fa-solid fa-bolt"></i>
                            <span>Instant Sync</span>
                        </div>
                    </div>
                </div>
                <div class="hero-bg-anim">
                    <div class="orb orb-1"></div>
                    <div class="orb orb-2"></div>
                </div>
            </div>

            <!-- Right Panel: Login Form -->
            <div class="login-panel">
                <div class="login-container">
                    <div class="mobile-brand">
                        <img src="assets/logo.png" alt="FieldHub" style="width: 48px; height: 48px;">
                        <h2>FieldHub</h2>
                    </div>

                    <div class="login-header text-center">
                        <div class="login-icon-glow">
                            <i class="fa-solid fa-layer-group"></i>
                        </div>
                        <h3>Welcome Back</h3>
                        <p>Sign in to continue</p>
                    </div>

                    <!-- Role Selector Removed for Cleaner UI -->

                    <form id="login-form">
                        <div class="input-group floating-label">
                            <i class="fa-solid fa-envelope"></i>
                            <input type="email" id="login-email" placeholder=" " required>
                            <label for="login-email">Email Address</label>
                        </div>
                        <div class="input-group floating-label">
                            <i class="fa-solid fa-lock"></i>
                            <input type="password" id="login-password" placeholder=" " required>
                            <label for="login-password">Password</label>
                        </div>

                        <button type="submit" class="btn-primary btn-block btn-lg">
                            Access Portal <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </form>

                    <p class="login-footer">
                        Need an account? <a href="#" onclick="UI.openModal('registration-modal')">Join the team</a>
                    </p>
                </div>
            </div>
        </section>

        <!-- Admin Dashboard -->
        <section id="admin-view" class="view hidden">
            <nav class="sidebar glass-panel">
                <div class="nav-brand">
                    <img src="assets/logo.png" alt="FieldHub" style="width: 48px; height: 48px;">
                    <span>FieldHub</span>
                </div>
                <ul class="nav-links">
                    <li class="active"><a href="#overview"><i class="fa-solid fa-chart-pie"></i> Overview</a></li>
                    <li><a href="#map"><i class="fa-solid fa-map-location-dot"></i> Live Map</a></li>
                    <li><a href="#projects"><i class="fa-solid fa-folder-tree"></i> Projects</a></li>
                    <li><a href="#sites"><i class="fa-solid fa-map-location-dot"></i> Sites</a></li>
                    <li><a href="#registrations"><i class="fa-solid fa-user-plus"></i> Join Req.</a></li>
                    <li><a href="#staff"><i class="fa-solid fa-users"></i> Staff</a></li>

                    <li><a href="#tasks"><i class="fa-solid fa-list-check"></i> Tasks</a></li>
                    <li><a href="#calendar"><i class="fa-solid fa-calendar-days"></i> Calendar</a></li>
                    <li><a href="#attendance"><i class="fa-solid fa-clock"></i> Logs</a></li>
                    <li><a href="#reports"><i class="fa-solid fa-file-alt"></i> Reports</a></li>
                    <li><a href="#messages"><i class="fa-solid fa-comments"></i> Messages</a></li>
                    <li><a href="#leave"><i class="fa-solid fa-calendar-check"></i> Leave</a></li>
                    <li><a href="#data"><i class="fa-solid fa-database"></i> Data</a></li>
                </ul>
                <div class="user-profile">
                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=6366f1&color=fff" alt="Admin">
                    <div class="user-info">
                        <h4>Admin</h4>
                        <div style="display:flex; justify-content:space-between; margin-top:5px;">
                            <span onclick="toggleTheme()"
                                style="cursor: pointer; font-size:0.85rem; color:var(--text-secondary);"><i
                                    class="theme-icon fa-solid fa-moon"></i> Theme</span>
                            <span id="logout-btn"
                                style="cursor: pointer; font-size:0.85rem; color:var(--text-secondary);"><i
                                    class="fa-solid fa-arrow-right-from-bracket"></i> Logout</span>
                        </div>
                    </div>
                </div>
            </nav>

            <main class="main-content">
                <header class="top-bar glass-panel">
                    <h2>Dashboard</h2>
                    <div class="status-indicators">
                        <div class="status-item online">
                            <span class="dot"></span> System Operational
                        </div>
                        <div class="date-display" id="current-date">--/--/----</div>
                    </div>
                </header>

                <div class="content-area">
                    <!-- Overview Tab (BENTO GRID) -->
                    <div id="tab-overview" class="tab-content active">
                        <div class="bento-grid expanded">
                            <!-- Hero Tile -->
                            <div class="bento-tile hero span-4">
                                <div class="hero-content">
                                    <span class="eyebrow">Dashboard Overview</span>
                                    <h1>Welcome back, <span id="admin-name">Admin</span> üëã</h1>
                                    <p class="hero-subtitle">Your team is performing well today.</p>
                                </div>
                                <div class="hero-actions">
                                    <button class="action-pill" onclick="openModal('task-modal')"><i
                                            class="fa-solid fa-plus"></i> New Task</button>
                                    <button class="action-pill" onclick="openModal('broadcast-modal')"><i
                                            class="fa-solid fa-bullhorn"></i> Broadcast</button>
                                    <button class="action-pill outline" onclick="switchAdminTab('staff')"><i
                                            class="fa-solid fa-users"></i> View Staff</button>
                                </div>
                            </div>

                            <!-- Stat Cards Row -->
                            <div class="bento-tile stat-card blue">
                                <div class="stat-icon"><i class="fa-solid fa-users"></i></div>
                                <div class="stat-content">
                                    <span class="stat-value" id="stat-active-staff">0</span>
                                    <span class="stat-title">Active Staff</span>
                                </div>
                            </div>

                            <div class="bento-tile stat-card green">
                                <div class="stat-icon"><i class="fa-solid fa-check-double"></i></div>
                                <div class="stat-content">
                                    <span class="stat-value" id="stat-completed-tasks">0</span>
                                    <span class="stat-title">Tasks Done</span>
                                </div>
                            </div>

                            <div class="bento-tile stat-card orange">
                                <div class="stat-icon"><i class="fa-solid fa-clock"></i></div>
                                <div class="stat-content">
                                    <span class="stat-value" id="stat-leave-reqs">0</span>
                                    <span class="stat-title">Leave Requests</span>
                                </div>
                            </div>

                            <div class="bento-tile stat-card purple">
                                <div class="stat-icon"><i class="fa-solid fa-file-lines"></i></div>
                                <div class="stat-content">
                                    <span class="stat-value" id="stat-reports">0</span>
                                    <span class="stat-title">Reports Filed</span>
                                </div>
                            </div>

                            <!-- Live Map Preview -->
                            <div class="bento-tile map-tile span-2 row-2">
                                <div class="tile-header">
                                    <h4><i class="fa-solid fa-earth-americas"></i> Live Operations</h4>
                                    <button class="chip-btn" onclick="switchAdminTab('map')">Expand</button>
                                </div>
                                <div id="overview-map" class="mini-map-container"></div>
                            </div>

                            <!-- Activity Feed -->
                            <div class="bento-tile activity-tile span-2 row-2">
                                <div class="tile-header">
                                    <h4><i class="fa-solid fa-bell"></i> Activity Feed</h4>
                                    <span class="badge">Live</span>
                                </div>
                                <ul class="activity-list" id="activity-log">
                                    <li class="skeleton-item"></li>
                                    <li class="skeleton-item"></li>
                                    <li class="skeleton-item"></li>
                                    <li class="skeleton-item"></li>
                                </ul>
                            </div>

                            <!-- AI Daily Briefing -->
                            <div class="bento-tile ai-briefing-tile span-4">
                                <div class="tile-header">
                                    <h4><i class="fa-solid fa-robot"></i> AI Daily Briefing</h4>
                                    <button class="chip-btn" id="generate-briefing-btn"
                                        onclick="window.generateDailyBriefing()">
                                        <i class="fa-solid fa-wand-magic-sparkles"></i> Generate
                                    </button>
                                </div>
                                <div id="ai-briefing-container"
                                    style="padding: 16px; font-size: 0.95rem; line-height: 1.6; color: var(--text-secondary); min-height: 80px;">
                                    <p style="color: var(--text-muted); font-style: italic;">Click "Generate" to get an
                                        AI-powered summary of today's operations (powered by Llama 3.3).</p>
                                </div>
                            </div>

                            <!-- Weekly Engagement Chart (Larger) -->
                            <div class="bento-tile chart-tile span-2">
                                <div class="tile-header">
                                    <h4><i class="fa-solid fa-chart-line"></i> Weekly Engagement</h4>
                                    <button class="chip-btn" onclick="openModal('analytics-modal')"><i
                                            class="fa-solid fa-expand"></i></button>
                                </div>
                                <div class="chart-container large"><canvas id="engagementChart"></canvas></div>
                            </div>

                            <!-- Task Distribution Chart -->
                            <div class="bento-tile chart-tile">
                                <div class="tile-header">
                                    <h4><i class="fa-solid fa-chart-pie"></i> Task Breakdown</h4>
                                </div>
                                <div class="chart-container"><canvas id="taskDistChart"></canvas></div>
                            </div>

                            <!-- Attendance Rate -->
                            <div class="bento-tile analytics-card">
                                <div class="analytics-header">
                                    <h4><i class="fa-solid fa-calendar-check"></i> Attendance</h4>
                                </div>
                                <div class="analytics-value">
                                    <span class="big-num" id="stat-attendance">92%</span>
                                    <span class="trend up"><i class="fa-solid fa-arrow-up"></i> +3%</span>
                                </div>
                            </div>

                            <!-- Productivity Rate (New) -->
                            <div class="bento-tile analytics-card">
                                <div class="analytics-header">
                                    <h4><i class="fa-solid fa-bolt"></i> Productivity</h4>
                                </div>
                                <div class="analytics-value">
                                    <span class="big-num" id="stat-productivity">87%</span>
                                    <span class="trend up"><i class="fa-solid fa-arrow-up"></i> +5%</span>
                                </div>
                            </div>

                            <!-- Full Analytics Button -->
                            <div class="bento-tile analytics-cta span-4">
                                <div class="cta-content">
                                    <i class="fa-solid fa-chart-simple"></i>
                                    <div>
                                        <h4>View Full Analytics</h4>
                                        <p>See detailed reports and trends</p>
                                    </div>
                                </div>
                                <button class="btn-primary" onclick="openModal('analytics-modal')"><i
                                        class="fa-solid fa-arrow-right"></i> Open Analytics</button>
                            </div>
                        </div>
                    </div>

                    <!-- Map Tab -->
                    <div id="tab-map" class="tab-content hidden" style="height: calc(100vh - 120px);">
                        <div id="ops-map" class="map-container"
                            style="width: 100%; height: 100%; border-radius: 16px; overflow: hidden; z-index: 1;"></div>
                    </div>

                    <!-- Projects Tab -->
                    <div id="tab-projects" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 20px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>Projects & Operations</h3>
                                <button class="btn-primary" onclick="openModal('project-modal')"><i
                                        class="fa-solid fa-folder-plus"></i> Add Project</button>
                            </div>
                            <div id="admin-project-list" class="responsive-grid">
                                <!-- Projects populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Sites Tab -->
                    <div id="tab-sites" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 20px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>Workplaces & Geofences</h3>
                                <button class="btn-primary" onclick="openModal('site-modal')"><i
                                        class="fa-solid fa-plus"></i> Add Site</button>
                            </div>
                            <div id="admin-site-list" class="responsive-grid">
                                <!-- Sites populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Registrations Tab -->
                    <div id="tab-registrations" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 20px;">
                            <h3>Pending Registrations</h3>
                            <div id="admin-registration-list" class="responsive-grid" style="margin-top: 20px;">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Staff Tab -->
                    <div id="tab-staff" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 20px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>Field Staff Directory</h3>
                                <button class="btn-primary" onclick="openAddWorkerModal()"><i
                                        class="fa-solid fa-users"></i> Add Worker</button>
                            </div>
                            <div id="staff-list" class="responsive-grid">
                                <!-- Staff populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Tasks Tab -->
                    <div id="tab-tasks" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 20px;">
                            <div class="flex-between"
                                style="display:flex; justify-content:space-between; margin-bottom: 20px;">
                                <h3>All Tasks</h3>
                                <button class="btn-primary" style="width: auto;" onclick="openModal('task-modal')"><i
                                        class="fa-solid fa-plus"></i> New Task</button>
                            </div>
                            <div id="admin-task-list">
                                <!-- Tasks Table Style -->
                            </div>
                        </div>
                    </div>



                    <!-- Calendar Tab -->
                    <div id="tab-calendar" class="tab-content hidden" style="height: calc(100vh - 120px);">
                        <div class="glass-panel" style="height:100%; padding:20px; overflow:hidden;">
                            <div id="admin-calendar" style="height:100%;"></div>
                        </div>
                    </div>

                    <!-- Attendance Tab -->
                    <div id="tab-attendance" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 20px;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                                <h3 style="margin:0;">Attendance Logs</h3>
                                <div class="dropdown">
                                    <button class="btn-outline btn-sm dropdown-trigger"
                                        onclick="toggleDropdown('attendance-export-menu')">
                                        <i class="fa-solid fa-download"></i> Export
                                    </button>
                                    <div id="attendance-export-menu" class="dropdown-menu hidden glass-panel"
                                        style="position:absolute; right:0; z-index:10; width:150px; flex-direction:column;">
                                        <button class="btn-text" onclick="exportAttendance('csv')">CSV</button>
                                        <button class="btn-text" onclick="exportAttendance('json')">JSON</button>
                                    </div>
                                </div>
                            </div>
                            <div id="attendance-log-list" style="max-height: 70vh; overflow-y: auto;">
                                <!-- Attendance logs populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="tab-reports" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 20px;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                                <h3 style="margin:0;">Field Reports</h3>
                                <div class="dropdown">
                                    <button class="btn-outline btn-sm dropdown-trigger"
                                        onclick="toggleDropdown('reports-export-menu')">
                                        <i class="fa-solid fa-download"></i> Export
                                    </button>
                                    <div id="reports-export-menu" class="dropdown-menu hidden glass-panel"
                                        style="position:absolute; right:0; z-index:10; width:150px; flex-direction:column;">
                                        <button class="btn-text" onclick="exportReports('csv')">CSV</button>
                                        <button class="btn-text" onclick="exportReports('json')">JSON</button>
                                    </div>
                                </div>
                            </div>
                            <div id="admin-reports-list" style="max-height: 70vh; overflow-y: auto;">
                                <!-- Reports populated by JS -->
                            </div>
                        </div>
                    </div>



                    <!-- Leave Tab -->
                    <div id="tab-leave" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 20px;">
                            <h3>Leave Requests</h3>
                            <div id="admin-leave-list" style="margin-top: 20px;">
                                <!-- Leave Items -->
                            </div>
                        </div>
                    </div>

                    <!-- Messages Tab -->
                    <div id="tab-messages" class="tab-content hidden">
                        <div id="admin-chat-container" style="height: 100%;"></div>
                    </div>

                    <!-- Data Management Tab -->
                    <div id="tab-data" class="tab-content hidden">
                        <div class="glass-panel" style="padding: 24px;">
                            <h3><i class="fa-solid fa-database"></i> Data Management</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 24px;">
                                Manage your database to stay within the limits (1GB). Export backups and archive old
                                data.
                            </p>

                            <!-- Backup Section -->
                            <div class="data-section"
                                style="margin-bottom: 32px; padding: 20px; background: var(--card-bg); border-radius: 16px; border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 12px;"><i class="fa-solid fa-download"></i> Full Backup</h4>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px;">
                                    Download a complete snapshot of all your data as JSON.
                                </p>
                                <button class="btn-primary" onclick="window.exportFullBackup()">
                                    <i class="fa-solid fa-cloud-arrow-down"></i> Download Full Backup
                                </button>
                            </div>

                            <!-- Archive Section -->
                            <div class="data-section"
                                style="margin-bottom: 32px; padding: 20px; background: var(--card-bg); border-radius: 16px; border: 1px solid var(--border);">
                                <h4 style="margin-bottom: 12px;"><i class="fa-solid fa-box-archive"></i> Archive Old
                                    Data</h4>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px;">
                                    Export data older than a specified period. This does NOT delete data.
                                </p>
                                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                                    <label style="font-size: 0.9rem;">Older than:</label>
                                    <select id="archive-months" class="input-light" style="width: 120px;">
                                        <option value="3">3 Months</option>
                                        <option value="6" selected>6 Months</option>
                                        <option value="12">12 Months</option>
                                    </select>
                                    <button class="btn-primary" onclick="window.previewArchive()">
                                        <i class="fa-solid fa-eye"></i> Preview
                                    </button>
                                    <button class="btn-outline" onclick="window.exportArchive()">
                                        <i class="fa-solid fa-file-export"></i> Export Only
                                    </button>
                                </div>
                                <div id="archive-preview"
                                    style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; display: none;">
                                    <!-- Preview results -->
                                </div>
                            </div>

                            <!-- Purge Section -->
                            <div class="data-section"
                                style="padding: 20px; background: rgba(239, 68, 68, 0.05); border-radius: 16px; border: 1px solid rgba(239, 68, 68, 0.2);">
                                <h4 style="margin-bottom: 12px; color: #ef4444;"><i class="fa-solid fa-trash-can"></i>
                                    Purge Old Data</h4>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px;">
                                    <strong>‚ö†Ô∏è Danger Zone:</strong> This will permanently delete old data after
                                    exporting a backup.
                                </p>
                                <button class="btn-danger" onclick="window.archiveAndPurge()">
                                    <i class="fa-solid fa-trash"></i> Archive & Purge
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </section>

        <!-- Field Staff App -->
        <section id="field-view" class="view hidden">
            <header class="mobile-header glass-panel">
                <div class="logo-small">
                    <img src="assets/logo.png" alt="FieldHub" style="width: 48px; height: 48px;">
                </div>
                <div class="user-greeting">
                    <span>Hello,</span>
                    <h3 id="field-user-name">Staff Member</h3>
                </div>
                <button class="icon-btn" onclick="toggleTheme()" title="Theme" style="margin-right:8px;">
                    <i class="theme-icon fa-solid fa-moon"></i>
                </button>
                <button class="icon-btn" id="field-logout" title="Logout">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </button>
            </header>

            <main class="mobile-content">
                <!-- Home Tab -->
                <div id="field-tab-home" class="field-tab active">
                    <!-- Clock In/Out Section -->
                    <div class="attendance-card glass-panel">
                        <div class="status-circle" id="attendance-status-circle">
                            <i class="fa-solid fa-user-clock"></i>
                        </div>
                        <div class="attendance-controls">
                            <p id="attendance-text">You are currently clocked OUT</p>
                            <button id="clock-btn" class="btn-primary pulse-btn">Clock In</button>
                        </div>
                        <div class="location-badge">
                            <i class="fa-solid fa-location-crosshairs"></i> <span
                                id="current-location-text">Locating...</span>
                        </div>
                    </div>

                    <h3>Your Tasks</h3>
                    <div class="task-list" id="field-task-list">
                        <!-- Tasks populated by JS -->
                    </div>
                </div>

                <!-- Leave Tab -->
                <div id="field-tab-leave" class="field-tab hidden" style="padding:20px;">
                    <h3>My Leave Requests</h3>
                    <button class="btn-primary" onclick="openModal('leave-modal')" style="margin-bottom: 20px;">+
                        Request Leave</button>
                    <div id="field-leave-list"></div>
                </div>

                <!-- Messages Tab -->
                <div id="field-tab-messages" class="field-tab hidden" style="height: calc(100vh - 140px);">
                    <!-- Filled by JS -->
                </div>

                <!-- Reports Tab -->
                <div id="field-tab-reports" class="field-tab hidden" style="padding: 20px;">
                    <h3>My Reports</h3>
                    <button class="btn-primary" onclick="openModal('report-modal')"
                        style="width:100%; margin-bottom:20px;">
                        <i class="fa-solid fa-camera"></i> Submit New Report
                    </button>
                    <div id="field-my-reports-list" style="display:flex; flex-direction:column; gap:12px;">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- Profile Tab -->
                <div id="field-tab-profile" class="field-tab hidden" style="padding: 20px;">
                    <div class="glass-panel" style="padding: 20px;">
                        <h3 style="margin-bottom: 20px;">My Profile</h3>
                        <form id="field-profile-form">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <img id="profile-avatar-preview" src=""
                                    style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--primary); margin-bottom: 10px;">
                                <p id="profile-email-display" style="color: var(--text-muted); font-size: 0.9rem;"></p>
                            </div>

                            <div class="input-group" style="margin-bottom: 12px;">
                                <label
                                    style="display:block; margin-bottom:4px; font-size:0.85rem; color:var(--text-secondary);">Full
                                    Name</label>
                                <input type="text" name="name" class="input-light" required>
                            </div>

                            <div class="input-group" style="margin-bottom: 12px;">
                                <label
                                    style="display:block; margin-bottom:4px; font-size:0.85rem; color:var(--text-secondary);">Phone
                                    Number</label>
                                <input type="tel" name="phone" class="input-light" required>
                            </div>

                            <div class="input-group" style="margin-top: 15px; margin-bottom: 12px;">
                                <label
                                    style="display:block; margin-bottom:4px; font-size:0.85rem; color:var(--text-secondary);">Skills
                                    / Expertise</label>
                                <input type="text" name="skills" class="input-light"
                                    placeholder="e.g. First Aid, Driving, Surveying">
                            </div>

                            <button type="submit" class="btn-primary" style="width: 100%; margin-top: 20px;">Save
                                Changes</button>
                        </form>

                        <hr style="border: 0; border-top: 1px solid var(--border); margin: 20px 0;">

                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <span>Dark Mode</span>
                            <div class="theme-toggle" onclick="toggleTheme()"
                                style="position:static; width:40px; height:40px;">
                                <i class="theme-icon fa-solid fa-moon"></i>
                            </div>
                        </div>

                        <button id="field-tab-logout" class="btn-outline"
                            style="width: 100%; border-color: #ef4444; color: #ef4444;">
                            <i class="fa-solid fa-right-from-bracket"></i> Logout
                        </button>
                    </div>
                </div>

            </main>

            <nav class="mobile-nav glass-panel">
                <a href="#home" class="active" data-target="field-tab-home"><i class="fa-solid fa-house"></i></a>
                <a href="#messages" data-target="field-tab-messages"><i class="fa-solid fa-comments"></i></a>
                <a href="#reports" data-target="field-tab-reports"><i class="fa-solid fa-camera"></i></a>
                <a href="#leave" data-target="field-tab-leave"><i class="fa-solid fa-calendar-day"></i></a>
                <a href="#profile" data-target="field-tab-profile"><i class="fa-solid fa-user-gear"></i></a>
            </nav>
        </section>

        <!-- Modals -->
        <!-- Task Modal -->
        <div id="task-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <h3>Assign New Task</h3>
                <form id="create-task-form">
                    <input type="text" name="title" placeholder="Task Title" required class="input-light">
                    <input type="text" name="location" placeholder="Location Name" required class="input-light">
                    <select name="assignedTo" id="staff-select" class="input-light">
                        <!-- Filled by JS -->
                    </select>
                    <div class="flex-gap">
                        <select name="priority" class="input-light">
                            <option value="low">Low Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="high">High Priority</option>
                        </select>
                        <input type="time" name="time" required class="input-light">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-text" onclick="closeModal('task-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Assign Task</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Leave Modal -->
        <div id="leave-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <h3>Request Leave</h3>
                <form id="leave-form">
                    <label style="display:block; margin:10px 0 5px; font-size:0.9rem;">Leave Type</label>
                    <select name="type" class="input-light" required>
                        <option value="Sick Leave">Sick Leave</option>
                        <option value="Personal">Personal Leave</option>
                        <option value="Vacation">Vacation</option>
                    </select>

                    <div style="display: flex; gap: 10px;">
                        <div style="flex:1;">
                            <label style="display:block; margin:10px 0 5px; font-size:0.9rem;">Start Date</label>
                            <input type="date" name="startDate" class="input-light" required>
                        </div>
                        <div style="flex:1;">
                            <label style="display:block; margin:10px 0 5px; font-size:0.9rem;">End Date</label>
                            <input type="date" name="endDate" class="input-light" required>
                        </div>
                    </div>

                    <label style="display:block; margin:10px 0 5px; font-size:0.9rem;">Reason / Notes</label>
                    <textarea name="reason" placeholder="Reason (Optional)" class="input-light" rows="3"></textarea>

                    <div class="modal-actions">
                        <button type="button" class="btn-text" onclick="closeModal('leave-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Submit Request</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Report Modal -->
        <div id="report-modal" class="modal hidden">
            <div class="modal-content glass-panel" style="max-width: 500px;">
                <h3><i class="fa-solid fa-file-lines"></i> Submit Field Report</h3>

                <!-- Smart Templates -->
                <div style="margin-bottom: 12px;">
                    <label
                        style="font-size: 0.8rem; color: var(--text-muted); display: block; margin-bottom: 6px;">Quick
                        Templates:</label>
                    <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                        <button type="button" class="template-btn" onclick="applyTemplate('daily')">üìã Daily
                            Update</button>
                        <button type="button" class="template-btn" onclick="applyTemplate('issue')">‚ö†Ô∏è Issue
                            Report</button>
                        <button type="button" class="template-btn" onclick="applyTemplate('maintenance')">üîß
                            Maintenance</button>
                        <button type="button" class="template-btn" onclick="applyTemplate('observation')">üëÅÔ∏è
                            Observation</button>
                    </div>
                </div>

                <form id="report-form">
                    <!-- Report Content with Voice & AI buttons -->
                    <div style="position: relative;">
                        <textarea name="content" id="report-content" placeholder="Describe the situation..." rows="5"
                            class="input-light" required style="padding-right: 80px;"></textarea>
                        <div style="position: absolute; top: 8px; right: 8px; display: flex; gap: 6px;">
                            <button type="button" class="voice-btn" onclick="toggleVoiceInput()" title="Voice Input">
                                <i class="fa-solid fa-microphone" id="mic-icon"></i>
                            </button>
                            <button type="button" class="ai-helper-btn" onclick="openAIHelper()" title="AI Help">
                                <i class="fa-solid fa-wand-magic-sparkles"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Voice Language Selector & Status -->
                    <div id="voice-controls"
                        style="display: none; margin-bottom: 10px; padding: 10px; background: rgba(99, 102, 241, 0.1); border-radius: 6px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <label style="font-size: 0.8rem; color: var(--text-muted);">Voice Language:</label>
                            <select id="voice-language" class="input-light"
                                style="padding: 4px 8px; font-size: 0.8rem; width: auto;">
                                <option value="en-IN">English (India)</option>
                                <option value="hi-IN">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                                <option value="bn-IN">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                                <option value="mr-IN">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                                <option value="te-IN">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                                <option value="ta-IN">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                                <option value="gu-IN">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                                <option value="ur-IN">ÿßÿ±ÿØŸà (Urdu)</option>
                                <option value="kn-IN">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                                <option value="or-IN">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü (Odia)</option>
                                <option value="ml-IN">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</option>
                                <option value="pa-IN">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</option>
                                <option value="as-IN">‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ (Assamese)</option>
                                <option value="ne-NP">‡§®‡•á‡§™‡§æ‡§≤‡•Ä (Nepali)</option>
                                <option value="en-US">English (US)</option>
                            </select>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--primary);">
                            <i class="fa-solid fa-circle-dot" style="animation: pulse 1s infinite;"></i>
                            <span id="voice-status-text">Listening...</span>
                        </div>
                    </div>

                    <!-- One-Tap Tags -->
                    <div style="margin-bottom: 12px;">
                        <label
                            style="font-size: 0.8rem; color: var(--text-muted); display: block; margin-bottom: 6px;">Quick
                            Tags:</label>
                        <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                            <button type="button" class="tag-btn tag-success" onclick="addTag('‚úÖ Completed')">‚úÖ
                                Completed</button>
                            <button type="button" class="tag-btn tag-warning" onclick="addTag('‚ö†Ô∏è Needs Material')">‚ö†Ô∏è
                                Needs Material</button>
                            <button type="button" class="tag-btn tag-danger" onclick="addTag('üö® Emergency')">üö®
                                Emergency</button>
                            <button type="button" class="tag-btn tag-info" onclick="addTag('üîÑ Follow-up Required')">üîÑ
                                Follow-up</button>
                        </div>
                    </div>

                    <!-- Photo Upload -->
                    <div class="upload-area" id="upload-area-display" style="margin-bottom: 12px;">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                        <p>Click to upload photo</p>
                        <input type="file" id="report-photo" name="photo" accept="image/*" style="display: none;">
                    </div>
                    <div id="photo-preview" style="display: none; margin-bottom: 12px;">
                        <img id="preview-image" style="max-width: 100%; border-radius: 8px; max-height: 200px;">
                        <button type="button" class="btn-text" onclick="removePhoto()" style="margin-top: 8px;">Remove
                            Photo</button>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-text" onclick="closeModal('report-modal')">Cancel</button>
                        <button type="submit" class="btn-primary"><i class="fa-solid fa-paper-plane"></i> Submit
                            Report</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- AI Report Helper Modal -->
        <div id="ai-helper-modal" class="modal hidden">
            <div class="modal-content glass-panel" style="max-width: 420px;">
                <h3><i class="fa-solid fa-wand-magic-sparkles"></i> AI Report Helper</h3>
                <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 16px;">Answer a few questions and
                    I'll write your report!</p>

                <div id="ai-helper-chat" style="max-height: 300px; overflow-y: auto; margin-bottom: 12px;">
                    <!-- Chat messages will appear here -->
                </div>

                <div id="ai-helper-input-area">
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="ai-helper-input" class="input-light" placeholder="Type your answer..."
                            style="flex: 1;">
                        <button type="button" class="btn-primary" onclick="sendAIHelperAnswer()"
                            style="padding: 10px 16px;">
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <div id="ai-helper-generating" style="display: none; text-align: center; padding: 20px;">
                    <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary);"></i>
                    <p style="margin-top: 10px; color: var(--text-muted);">Generating your report...</p>
                </div>

                <div class="modal-actions" style="margin-top: 12px;">
                    <button type="button" class="btn-text" onclick="closeModal('ai-helper-modal')">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Project Modal -->
        <div id="project-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <h3>Create New Project</h3>
                <form id="project-form">
                    <input type="text" name="name" placeholder="Project Name" required class="input-light">
                    <textarea name="description" placeholder="Project Description" rows="3"
                        class="input-light"></textarea>
                    <input type="text" name="manager" placeholder="Project Manager" class="input-light">
                    <div class="modal-actions">
                        <button type="button" class="btn-text" onclick="closeModal('project-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Create Project</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Site Modal -->
        <div id="site-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <h3>Add Workplace / Geofence</h3>
                <form id="site-form">
                    <input type="text" name="name" placeholder="Site Name" required class="input-light">
                    <select name="projectId" id="site-project-select" class="input-light">
                        <option value="">-- No Project (General) --</option>
                        <!-- Populated by JS -->
                    </select>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" name="lat" placeholder="Latitude" required class="input-light">
                        <input type="text" name="lng" placeholder="Longitude" required class="input-light">
                    </div>
                    <input type="number" name="radius" placeholder="Radius (meters)" value="200" required
                        class="input-light">
                    <!-- Helper Text -->
                    <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: -10px; margin-bottom: 20px;">
                        <i class="fa-solid fa-info-circle"></i> Use Google Maps to find Lat/Lng. Workers must be within
                        this radius to clock in.
                    </p>
                    <div class="modal-actions">
                        <button type="button" class="btn-text" onclick="closeModal('site-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Save Site</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Worker Modal -->
        <div id="worker-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <h3>Add Field Worker</h3>
                <form id="worker-form">
                    <input type="hidden" name="workerId" value="">
                    <input type="text" name="name" placeholder="Full Name" required class="input-light">
                    <input type="email" name="email" placeholder="Email Address" required class="input-light">
                    <input type="tel" name="phone" placeholder="Phone (10 digits)" required class="input-light"
                        pattern="\d{10}">

                    <select name="role" class="input-light mobile-compatible" required style="margin-bottom: 15px;">
                        <option value="field">Field Staff</option>
                        <option value="admin">Admin / Manager</option>
                    </select>
                    <input type="password" name="password" placeholder="Password (for login)" required
                        class="input-light" minlength="6">
                    <select name="assignedSite" id="site-select" class="input-light" required>
                        <option value="">Select Workplace/Office</option>
                        <!-- Filled by JS -->
                    </select>
                    <div class="modal-actions">
                        <button type="button" class="btn-text" onclick="closeModal('worker-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Add Worker</button>
                    </div>
                </form>
            </div>
        </div>



        <!-- Dynamic Form Renderer (Field/Admin) -->
        <div id="dynamic-form-modal" class="modal hidden">
            <div class="modal-content glass-panel">
                <div style="text-align: right;">
                    <button class="btn-text" onclick="window.UI.closeModal('dynamic-form-modal')"><i
                            class="fa-solid fa-times"></i></button>
                </div>
                <div id="dynamic-form-container">
                    <!-- Dynamic Form HTML -->
                </div>
            </div>
        </div>

        <!-- Translation Modal -->
        <div id="translate-modal" class="modal hidden">
            <div class="modal-content glass-panel" style="max-width: 360px;">
                <h3><i class="fa-solid fa-language"></i> Translate Report</h3>
                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px;">Select target language:
                </p>
                <select id="translate-lang-select" class="input-light" style="margin-bottom: 16px;">
                    <option value="English">English</option>
                    <option value="Hindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                    <option value="Bengali">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                    <option value="Marathi">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                    <option value="Telugu">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                    <option value="Tamil">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                    <option value="Gujarati">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                    <option value="Urdu">ÿßÿ±ÿØŸà (Urdu)</option>
                    <option value="Kannada">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                    <option value="Odia">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü (Odia)</option>
                    <option value="Malayalam">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</option>
                    <option value="Punjabi">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</option>
                    <option value="Assamese">‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ (Assamese)</option>
                    <option value="Maithili">‡§Æ‡•à‡§•‡§ø‡§≤‡•Ä (Maithili)</option>
                    <option value="Santali">·±•·±ü·±±·±õ·±ü·±≤·±§ (Santali)</option>
                    <option value="Bodo">‡§¨‡§°‡§º‡•ã (Bodo)</option>
                    <option value="Dogri">‡§°‡•ã‡§ó‡§∞‡•Ä (Dogri)</option>
                    <option value="Kashmiri">⁄©Ÿ≤ÿ¥Ÿèÿ± (Kashmiri)</option>
                    <option value="Konkani">‡§ï‡•ã‡§Ç‡§ï‡§£‡•Ä (Konkani)</option>
                    <option value="Manipuri">‡¶Æ‡ßà‡¶§‡ßà‡¶≤‡ßã‡¶®‡ßç (Manipuri)</option>
                    <option value="Nepali">‡§®‡•á‡§™‡§æ‡§≤‡•Ä (Nepali)</option>
                    <option value="Sanskrit">‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§Æ‡•ç (Sanskrit)</option>
                    <option value="Sindhi">ÿ≥ŸÜ⁄åŸä (Sindhi)</option>
                </select>
                <div class="modal-actions">
                    <button type="button" class="btn-text" onclick="closeModal('translate-modal')">Cancel</button>
                    <button type="button" class="btn-primary"
                        onclick="performTranslation(document.getElementById('translate-lang-select').value)">
                        <i class="fa-solid fa-language"></i> Translate
                    </button>
                </div>
            </div>
        </div>

        <!-- Task Translation Modal -->
        <div id="translate-task-modal" class="modal hidden">
            <div class="modal-content glass-panel" style="max-width: 360px;">
                <h3><i class="fa-solid fa-language"></i> Translate Task</h3>
                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px;">Select target language:
                </p>
                <select id="translate-task-lang-select" class="input-light" style="margin-bottom: 16px;">
                    <option value="English">English</option>
                    <option value="Hindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                    <option value="Bengali">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                    <option value="Marathi">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                    <option value="Telugu">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                    <option value="Tamil">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                    <option value="Gujarati">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                    <option value="Urdu">ÿßÿ±ÿØŸà (Urdu)</option>
                    <option value="Kannada">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                    <option value="Odia">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü (Odia)</option>
                    <option value="Malayalam">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</option>
                    <option value="Punjabi">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</option>
                    <option value="Assamese">‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ (Assamese)</option>
                    <option value="Maithili">‡§Æ‡•à‡§•‡§ø‡§≤‡•Ä (Maithili)</option>
                    <option value="Santali">·±•·±ü·±±·±õ·±ü·±≤·±§ (Santali)</option>
                    <option value="Bodo">‡§¨‡§°‡§º‡•ã (Bodo)</option>
                    <option value="Dogri">‡§°‡•ã‡§ó‡§∞‡•Ä (Dogri)</option>
                    <option value="Kashmiri">⁄©Ÿ≤ÿ¥Ÿèÿ± (Kashmiri)</option>
                    <option value="Konkani">‡§ï‡•ã‡§Ç‡§ï‡§£‡•Ä (Konkani)</option>
                    <option value="Manipuri">‡¶Æ‡ßà‡¶§‡ßà‡¶≤‡ßã‡¶®‡ßç (Manipuri)</option>
                    <option value="Nepali">‡§®‡•á‡§™‡§æ‡§≤‡•Ä (Nepali)</option>
                    <option value="Sanskrit">‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§Æ‡•ç (Sanskrit)</option>
                    <option value="Sindhi">ÿ≥ŸÜ⁄åŸä (Sindhi)</option>
                </select>
                <div class="modal-actions">
                    <button type="button" class="btn-text" onclick="closeModal('translate-task-modal')">Cancel</button>
                    <button type="button" class="btn-primary"
                        onclick="performTaskTranslation(document.getElementById('translate-task-lang-select').value)">
                        <i class="fa-solid fa-language"></i> Translate
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- Registration Modal (Public) -->
    <div id="registration-modal" class="modal hidden">
        <div class="modal-content glass-panel">
            <h3>Volunteer Registration</h3>
            <form id="registration-form">
                <input type="text" name="name" placeholder="Full Name" required class="input-light">
                <input type="email" name="email" placeholder="Email Address" required class="input-light">

                <input type="text" name="skills" placeholder="Skills / Experience (Optional)" class="input-light">
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 15px;">
                    Your account will be reviewed by an administrator. You will be able to login once approved.
                </p>
                <div class="modal-actions">
                    <button type="button" class="btn-text" onclick="closeModal('registration-modal')">Cancel</button>
                    <button type="submit" class="btn-primary">Submit Registration</button>
                </div>
            </form>
        </div>
    </div>
    </div>

    <!-- Broadcast Modal -->
    <div id="broadcast-modal" class="modal hidden" style="display:none;">
        <div class="modal-content glass-panel">
            <h3>üì¢ Broadcast Alert</h3>
            <p style="color:var(--text-secondary); margin-bottom:15px;">Send a message to ALL field staff instantly.</p>
            <form onsubmit="window.sendBroadcast(event)">
                <textarea id="broadcast-input" rows="4" class="input-light" placeholder="Type your alert message..."
                    required></textarea>
                <div class="modal-actions">
                    <button type="button" class="btn-text" onclick="closeModal('broadcast-modal')">Cancel</button>
                    <button type="submit" class="btn-primary" style="background:var(--primary);">Send Alert</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Analytics Modal (Fullscreen) -->
    <div id="analytics-modal" class="modal fullscreen-modal hidden" style="display:none;">
        <div class="modal-content analytics-panel">
            <div class="analytics-modal-header">
                <h2><i class="fa-solid fa-chart-simple"></i> Full Analytics Dashboard</h2>
                <button class="close-btn" onclick="closeModal('analytics-modal')"><i
                        class="fa-solid fa-times"></i></button>
            </div>
            <div class="analytics-grid">
                <!-- Summary Stats -->
                <div class="analytics-stats-row">
                    <div class="analytics-stat"><span class="num" id="modal-active">0</span><span class="lbl">Active
                            Staff</span></div>
                    <div class="analytics-stat"><span class="num" id="modal-tasks">0</span><span class="lbl">Tasks
                            Completed</span></div>
                    <div class="analytics-stat"><span class="num" id="modal-attendance">92%</span><span
                            class="lbl">Attendance</span></div>
                    <div class="analytics-stat"><span class="num" id="modal-productivity">87%</span><span
                            class="lbl">Productivity</span></div>
                </div>
                <!-- Charts -->
                <div class="analytics-charts">
                    <div class="analytics-chart-card">
                        <h4>Weekly Engagement Overview</h4>
                        <div class="chart-lg"><canvas id="modalEngagementChart"></canvas></div>
                    </div>
                    <div class="analytics-chart-card">
                        <h4>Task Distribution</h4>
                        <div class="chart-lg"><canvas id="modalTaskChart"></canvas></div>
                    </div>
                    <div class="analytics-chart-card">
                        <h4>Monthly Attendance Trends</h4>
                        <div class="chart-lg"><canvas id="modalAttendanceChart"></canvas></div>
                    </div>
                    <div class="analytics-chart-card">
                        <h4>Project Completion Rate</h4>
                        <div class="chart-lg"><canvas id="modalProjectChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

    </div>

    <!-- Core Scripts (Must be last) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <!-- Firebase Config -->
    <script src="js/firebase-config.js"></script>

    <script src="js/store_v2.js"></script>
    <script src="js/features/export_utils.js"></script>
    <script src="js/services/ai_service.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script type="module" src="js/app_v2.js?v=final"></script>

    <!-- Failsafe Splash Removal -->
    <script>
        window.addEventListener('load', () => {
            setTimeout(() => {
                const splash = document.getElementById('splash-screen');
                if (splash) splash.classList.add('fade-out');
            }, 2000);
        });
    </script>
</body>

</html>